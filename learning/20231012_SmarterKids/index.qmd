---
title: "The Smartest Kids in the World"
author: "Bamini Balaji"
date: "2023-10-14"
categories: ["Book", "Mixed Models"]
image: "book_cover.jpg"
knitr:
  opts_chunk: 
    warning: false
    message: false
format:
  html:
    code-fold: true
    toc: true
    toc-expand: 4
freeze: true
---

Review and analysis of Amanda Ripley's "The Smartest Kids in the World and how they got that way".

## Amanda Ripley's The Smartest Kids in the World and how they got that way

If you are interested in the American education system or simply wondering if there is a secret sauce to making someone smart, then this book will be a fun read.

Having grown up in multiple countries (Canada, India, Kenya as well as USA), I've often wondered about the many differences in education systems globally. The more I read, I realized the anecdotal observations agreed with my personal experiences in American and non-American school systems. The book highlighted certain key features that paved the way for countries like Finland, South Korea, Poland and Singapore to improve their education outcomes - all while United States lags behind.

Given that the book shared perspectives of a handful of American foreign exchange students, I wanted to see if the claims were simply a cherry picked points or if they are backed by statistics. So here is my review and analysis of their conclusions. See @sec-book to skip to the book findings.

(Apparently the book has also been turned into a documentary which I'm definitely planning to check out once I figure out how to stream it! But the analysis was interesting in the meantime...)

## How did Ripley quantify "smart"?

The book used data from The PISA test which is an international standardized test that assesses 15 year old student's reading, math and science. Furthermore, it surveys their demographic backgrounds and intangible features such as attitudes towards schooling.

Luckily some of this data is available in an r package `learningtower`. So I wanted to dive into the data and try some mixed effects modeling ðŸ˜€

One caveat is that this dataset didn't dive into the more intangible aspects such as student attitudes and drive. But we can still look at demographic and socioeconomic factors contributing to academic success.

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(tidymodels)
library(learningtower)
library(plotly)
library(Hmisc)
library(corrplot)
library(lmtest)
library(sandwich)
library(lme4)
library(sjPlot)
library(kableExtra)
library(car)
library(gridExtra)


all_student <- load_student("all")
data("school")
data("countrycode")


school_student <- left_join(
  all_student, 
  school, 
  by = c("school_id", "country", "year")) %>%
  left_join(
    countrycode,
    by = "country"
  )

# Selecting a few countries 
countries <- c(
  "Brazil", "South Korea", "Japan", "United States",
  "Canada", "Singapore", "Malaysia", 
  "Finland", "Denmark", "Peru",
  "Poland", "Germany"
)
```

## Exploring the data

Here are the average PISA scores (with 1 standard deviation error bars) for countries with mostly complete datasets across multiple years. Finland and South Korea are definitely among top performers while Poland is in the upper half.

```{r explore, message=FALSE, warning=FALSE}
#| fig-width: 12
#| fig-height: 12

df <- school_student %>%
  select(year, country_name, math, read, science, stu_wgt) %>%
  pivot_longer(cols = c("math", "read", "science"), names_to = "subject", values_to = "scores") %>%
  #filter(subject == "math") %>%
  filter(!is.na(scores)) %>%
  filter(year %in% c(2006, 2009, 2012, 2015, 2018)) %>% 
  group_by(country_name, subject) %>%
  filter(n_distinct(year) == 5) %>%
  ungroup() %>% # Selecting countries with complete timelines
  group_by(country_name, year, subject) %>%
  dplyr::summarize(
    mean_score = weighted.mean(scores, w=stu_wgt),
    sd_score = sqrt(Hmisc::wtd.var(scores, weights=stu_wgt))
  ) %>%
  ungroup() %>%
  mutate(
    lower = mean_score-sd_score,
    upper = mean_score+sd_score
  )
  
df$country_name = reorder(df$country_name, df$mean_score, mean)
df$country_name <- droplevels(df$country_name)
p_yr <- df %>% 
  ggplot(aes(x = country_name, y = mean_score, color = year)) +
  geom_point(position = position_dodge(width = .5)) +
  geom_errorbar(aes(ymin = lower, ymax = upper), position=position_dodge(width = .5)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Global Scores by Subject") +
  xlab("Country") +
  ylab("Mean Score +/- 1 SD") + 
  theme(legend.position="top") + 
  facet_wrap(~subject, nrow=3, scales="free_y")

ggplotly(p_yr)

```

Here we see a time-series for select countries. USA is consistently below 500 is math scores while Finland, Poland and South Korea perform highly.

```{r explore2, message=FALSE, warning=FALSE}
#| fig-width: 10
#| fig-height: 6
p <- school_student %>%
  select(year, country_name, math, read, science, stu_wgt) %>%
  group_by(year, country_name) %>%
  dplyr::summarize(math = weighted.mean(math, w=stu_wgt), 
            read = weighted.mean(read, w=stu_wgt), 
            science = weighted.mean(science, w=stu_wgt)) %>%
  pivot_longer(cols = c("math", "read", "science"), names_to = "subject", values_to = "scores") %>%
  ungroup() %>%
  filter(country_name %in% countries) %>%
  mutate(year = as.numeric(as.character(year))) %>%
  ggplot(aes(x = year, y = scores, color = country_name)) +
  facet_wrap(~subject) + geom_point() + geom_line()

ggplotly(p)
```

## Linear Models

For simplicity, let's start with a linear model to explore the effect of each predictor

### How does a student score high?

Focusing on the math dataset for year 2018, first I cleaned up some of the variables.

At the individual student level, we have the following predictors: `mother_educ`, `father_educ`, `gender`, `computer`, `internet`, `desk`, `room`, `television`, `car`, `book`, `wealth`, `escs`. At the school level, we see the variables `fund_gov`, `fund_fees`, `fund_donation`, `enrol_boys`, `enrol_girls`, `stratio`, `public_private`, `staff_shortage`, `sch_wgt`, `school_size`. 

Some data wrangling:

-   Convert ordered categorical variables such as number of books and mother/father education levels to numerical values for ease of modeling and interpretation
-   Convert television, car and computer to binary values to indicate whether or not they were accessible rather than retaining the number of each that was available

```{r cleanup}

math_df <- school_student %>%
  filter(!is.na(math) & year == 2018) %>%
  mutate(television = as.character(television), computer = as.character(computer),
         car = as.character(car)) %>%
  mutate(television = ifelse(television %in% c("1", "2", "3+"), "yes", television)) %>%
  mutate(car = ifelse(car %in% c("1", "2", "3+"), "yes", car)) %>%
  mutate(computer = ifelse(((is.na(computer)) & (computer_n %in% c("1", "2", "3+"))), "yes", computer)) %>%
  mutate(
    n_books = case_when(
      book == "0-10" ~ 0,
      book == "11-25" ~ 1,
      book == "26-100" ~ 2,
      book == "201-500" ~ 3,
      book == "more than 500" ~ 4
    ),
    mother_educ_level = case_when(
      mother_educ == "less than ISCED1" ~ 0,
      mother_educ == "ISCED 1" ~ 1,
      mother_educ == "ISCED 2" ~ 2,
      mother_educ == "ISCED 3A" ~ 3,
      mother_educ == "ISCED 3B, C" ~ 3,
    ),
    father_educ_level = case_when(
      father_educ == "less than ISCED1" ~ 0,
      father_educ == "ISCED 1" ~ 1,
      father_educ == "ISCED 2" ~ 2,
      father_educ == "ISCED 3A" ~ 3,
      father_educ == "ISCED 3B, C" ~ 3,
    )
  )
```

Here are two simple linear models. The first exclusively looks at student level predictors and the second includes school level predictors. We see that all of these student level (first model) and school level (second model) variables may be predictive of a student's math scores. Interestingly, the added complexity with the second model is preferred because the AIC is lower.

```{r student}
lm_df <- math_df %>%
  mutate(boy_fraction = enrol_boys/school_size) %>%
  mutate_at(c("wealth", "escs","school_size", "staff_shortage", "mother_educ_level", "father_educ_level", "n_books",
              "fund_donation", "fund_gov", "fund_fees", "boy_fraction", "stratio"),
            ~(scale(.) %>% as.vector)) %>%
  select(math, mother_educ_level, father_educ_level, gender, computer, internet, desk, room, television, car, n_books, wealth, escs,
         fund_gov, fund_fees, fund_donation, school_size, stratio, public_private, staff_shortage, 
         country_name, school_id)

lmod <- (lm(math ~ mother_educ_level + father_educ_level + gender + computer + internet + desk +
              room + television + car + n_books + wealth + escs, lm_df, na.action="na.omit"))

lmod2 <- (lm(math ~ mother_educ_level + father_educ_level + gender + computer + internet + desk +
               room + television + car + n_books + wealth + escs +
               fund_gov + fund_fees + fund_donation + school_size + stratio + public_private + staff_shortage, 
             lm_df, na.action="na.omit"))

tab_model(lmod, lmod2, show.stat=TRUE, show.se = TRUE, show.aic = TRUE)
```


*Note:* Due to missing values, only a complete dataset of `r round(dim(na.omit(lm_df))[1]/dim(lm_df)[1]*100)`% was used in the linear model.

The above models treat students from all groups i.e. school and country as identical. We can improve on this by adding design based methods to account for the groupings. This is necessary because the t-statistic currently assumes a standard error based on n of total students irrespective of school or country. When we cluster by school and country, n within each group is smaller. Here are the adjusted p-values using a cluster-robust model.

```{r}
lmod_cr <- coeftest(lmod, vcov=vcovCL, cluster= ~ school_id + country_name)
lmod_cr

lmod2_cr <- coeftest(lmod2, vcov=vcovCL, cluster= ~ school_id + country_name)
lmod2_cr
```


-   After applying the inference adjustments for correlated errors within clusters, we see that father's education level affects test scores while mother's education does not. It's possibly that there is some correlation between these variables.

-   Gender does seem predictive of the score. If all other factors are equal, a boy would score `r round(lmod$coefficients["gendermale"],2)` points higher in math than a girl (when we only account for individual predictors)!

-   Presence of computer, internet and desk as well as more books lead to higher scores. TV also seems to have an impact albeit less significant. Having a separate room is not significant predictors of score.

-   Oddly, wealth is negatively predictive but not a significantly meaningful predictor of score. In contrast, `escs` or index of economic, social and cultural status is a strong predictor of score. One unit increase in `escs` leads to `r round(lmod$coefficients["escs"],2)` points increase in math scores with all other factors being equal for the individual variables model.

-   It seems counter intuitive that wealth is inversely correlated with score per the model and also not meaningful! We expect that poverty generally correlates with poorer education outcomes. Perhaps collinearity and interactions between predictors masks the individual effects seen here. Indeed, `wealth` is correlated with `escs` as seen below

```{r cor_var}
ggplot(lm_df %>% na.omit(), aes(x = wealth, y = escs)) +
  geom_point(alpha=0.05) +
  geom_smooth(method = "lm")
```

Furthermore, we see that there are correlations between several of the model predictors particularly `wealth` and `escs`

```{r cor_var2}
cor_var_df <- lm_df %>%
  mutate(gender = ifelse(gender == "male", 0.0, 1.0),
         computer = ifelse(computer == "yes", 1.0, 0.0),
         internet = ifelse(internet == "yes", 1.0, 0.0),
         desk = ifelse(desk == "yes", 1.0, 0.0),
         room = ifelse(room == "yes", 1.0, 0.0),
         television = ifelse(television == "yes", 1.0, 0.0),
         car = ifelse(car == "yes", 1.0, 0.0),
         public_private = ifelse(public_private == "public", 0.0, 1.0)
         ) %>%
  mutate(across(mother_educ_level:escs, as.double))

res <- cor(cor_var_df %>% select(-math, -gender, -country_name, -school_id), use = "complete.obs", method="spearman") 

corrplot(res, type = "upper", order = "hclust", tl.col = "black", tl.srt = 45)
```

The correlation plot above shows that there is a risk of multicollinearity since all variables are related. Here is the evaluation of variance inflation. It shows that `escs` and `wealth` have high variance inflation factors (VIFs).

```{r lmod_vif}
car::vif(lmod)
```

### How does a school score high on average?

A simple linear model here shows that most of these may be predictive of better school outcomes.

```{r school}
school_df <- math_df %>%
  group_by(school_id, fund_gov, fund_fees, fund_donation, enrol_boys, enrol_girls, school_size, stratio, public_private, staff_shortage, country_name) %>%
  dplyr::summarize(math = weighted.mean(math,w=stu_wgt,  na.rm = T)) %>%
  ungroup() %>%
  mutate(
    boy_fraction = enrol_boys/school_size
  ) %>%
  mutate_at(c("school_size", "staff_shortage", "stratio", "fund_donation", "fund_gov", "fund_fees", "boy_fraction"), ~(scale(.) %>% as.vector)) %>%
  select(-enrol_boys, -enrol_girls)

lsmod <- lm(math ~ fund_gov + fund_fees + fund_donation + boy_fraction + school_size + stratio + public_private + staff_shortage, school_df,
            na.action="na.omit")

tab_model(lsmod, show.stat=TRUE, show.se = TRUE)

lsmod_cr <- coeftest(lsmod, vcov=vcovCL, cluster= ~ country_name)
lsmod_cr
```

We again apply grouping based correlated error adjustments to our model as seen above for the country level groups.

-   There is a nearly collinear relationship in funding sources where `fund_fees + fund_donation + fund_gov = 100` unless there is a another nonspecific funding source. This explains why `fund_fees` is a non-significant predictor. Interestingly, `fund_gov` is also non-significant since this is likely related to public/private designation.

-   With all other factors being equal, a public school is `r round(abs(lsmod$coefficients["public_privatepublic"]),2)` points lower than a private school for math scores.

-   Schools with more students have higher average math scores. But as expected, higher student to teacher ratio inversely correlates with score as expected.

-   More boys attending the school seems to proportionally lower math scores for the school! This seems to go against the individual score model where boys seemed to score higher on the test.

-   Higher staff shortage in the school negatively influences the school's scores but not significantly.

*Note:* Due to missing values, only a complete dataset of `r round(dim(na.omit(school_df))[1]/dim(school_df)[1]*100)`% was used in the linear model.

We also see some risk of predictor correlations here particularly with respect to funding source and public/private status of school. Additionally, school size is positively correlated to student-teacher ratio.

```{r, school_cor_var}
s_cor_df <- school_df %>%
  mutate(public_private = ifelse(public_private == "public", 0.0, 1.0)) %>%
  select(-school_id, -math, -country_name) %>%
  mutate(across(fund_gov:boy_fraction, as.double))

res <- cor(s_cor_df, use = "complete.obs", method="spearman") 

corrplot(res, type = "upper", order = "hclust", tl.col = "black", tl.srt = 45)
```

## Mixed Effects Model

A mixed effects model should be more appropriate here over a simple linear model or a model with design adjustments for these reasons:

(1) We have hierarchical data (student within a school within a country). Clearly there is student-to-student variability based on the various indicators recorded in this data set. But we also see that groupings play an effect.
(2) The design based linear model did not offer insight into how schools and countries differ. It's possible that the variability in students may also be accounted for by school-to-school variability and country-to-country variability. We want to know how these grouping variables affect student as well as school-averaged scores.

The book described the socioeconomic factors for different countries that impacted their approach to education. So we expect these to affect our analysis.

For simplicity, I will look at the countries mentioned in the book (USA, South Korea, Poland and Finland) in the year of 2018.

Since there are correlations in some of the predictors `mother_education_level` and `wealth` were removed as predictors. Similarly for lack of interest `desk`, `room`, `television` and `car` were also excluded. At the school level, we remove `fund_gov` since it correlates with public/private designation and `fund_fees` since it is likely collinear and non-significant in the adjusted linear model.

Although, the predictors are correlated, we will lose interpretability by applying dimensionality reduction techniques such as PCA. Hence the above approach is ideal.

```{r lmer_data}

sub_math_df <- math_df %>%
  mutate(
    gender = ifelse(gender == "male", 0.0, 1.0),
    computer = ifelse(computer == "yes", 1.0, 0.0),
    internet = ifelse(internet == "yes", 1.0, 0.0),
    public_private = ifelse(public_private == "public", 0.0, 1.0),
    desk = ifelse(desk == "yes", 1.0, 0.0),
    room = ifelse(room == "yes", 1.0, 0.0),
    television = ifelse(television == "yes", 1.0, 0.0),
    car = ifelse(car == "yes", 1.0, 0.0)
  ) %>%
  mutate(boy_fraction = enrol_boys/school_size) %>% 
  select(math, student_id, country_name, 
         mother_educ_level,
         father_educ_level, gender, 
         computer, internet, 
         desk, room, television, car,
         n_books, 
         wealth,
         escs, school_id,
         fund_gov, fund_fees,
         fund_donation, 
         boy_fraction,
         stratio, public_private, staff_shortage, 
         school_size, stu_wgt, sch_wgt) %>%
  na.omit() %>%
  filter((country_name %in% c("United States", "South Korea",
                                              "Poland", "Finland"))) %>%
  mutate_at(c("wealth", "escs","school_size", "staff_shortage", "mother_educ_level", "father_educ_level", "n_books",
              "fund_donation", "fund_gov", "fund_fees", "stratio", "staff_shortage", "school_size", "boy_fraction"),
            ~(scale(., scale=FALSE) %>% as.vector))
```

If we group schools into public or private so that each country has 2 school levels (1 = private and 0 = public), we see that the classes are vastly imbalanced. More public school data available.

```{r school_diff}
#| tbl-colwidths: [60,20,20]
table(sub_math_df$country_name, sub_math_df$public_private) %>% knitr::kable()

```

```{r school_diff_2}
#| tbl-colwidths: [60,40]
sub_math_df %>% group_by(country_name) %>% dplyr::summarize(n_schools = n_distinct(school_id)) %>% knitr::kable()
```

`escs` and `gender` are interesting to model and likely correlate with other student level variables.

```{r plots}
ggplot(sub_math_df, aes(x = escs, y = math, color = as.factor(public_private))) +
  facet_wrap(~country_name) +
  geom_point(alpha = 0.2, aes(shape = as.factor(gender))) +
  scale_shape_manual(values = c(3, 16)) +
  geom_smooth(method = "lm", se=FALSE) +
  ggtitle("ESCS positively correlates with math scores")
```
With the exception of Finland, we see overlap in public/private groupings. So this may not be an effective grouping strategy. 

```{r plots2}
ggplot(sub_math_df, aes(x = country_name, y = math, color = gender)) +
  geom_boxplot() +
  ggtitle("Male/Female Score Distributions by Country")
```

### Students in Schools in a Country: 3 Level Model

Here is a hierarchical model with intercepts varying by countries and by grouping of schools within countries. We are assuming that each predictor influences schools and countries in the same way with **identical slopes** but **random intercepts** only for the random effects.

#### Public vs Private School Grouping

```{r model_pub_pri, class.source = 'fold-show'}
mod1 <- lmer(math ~ father_educ_level + gender + computer + internet + n_books + escs + (1 | country_name/public_private),
             #mother_educ_level + desk+ wealth + room + television + car + 
     data=sub_math_df,
     control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=20000)),
     weights = stu_wgt,
     REML = FALSE)

tab_model(mod1)

q <- plot_model(mod1, 
           type  = "re", 
           width = .5, 
           show.values = T)

grid.arrange(q[[1]], q[[2]], ncol=2)
```

As expected access to a computer, internet, more books and high socioeconomic status are positively predictive. Father's education is also positively predictive albeit low p-value and smaller effect size.

Looking at the random effects, private schools perform better than public school with greatest disparity seen in Poland. Controlling for other factors and looking at the "country" random effect, Poland and South Korea perform better than Finland. This is surprising because overall South Korea and Finland had higher average scores than Poland. Perhaps Poland's lower scores are explained by other predictors such as socioeconomic indicators that are accounted for in the model.



#### Individual School Groupings

Here is the mixed effects model grouping by schools within country. Although we are not interested in how individual schools perform, it is nice to understand the variability by school versus countries. We fit two models where the first looks at individual predictors only and the second also includes school level predictors.

```{r model_school_id}
mod1 <- lmer(math ~ #mother_educ_level + 
               father_educ_level + gender + computer + internet + 
               # desk + room + television + car + wealth + 
               n_books + escs  + (1 | country_name/school_id),
     data=sub_math_df,
     control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000)),
     weights = stu_wgt,
     REML = FALSE)

mod2 <- lmer(math ~ #mother_educ_level + 
               father_educ_level + gender + computer + internet + 
               # desk + room + television + car + wealth + 
               n_books + escs  + 
               school_size + stratio + public_private + boy_fraction +
               (1 | country_name/school_id),
     data=sub_math_df,
     control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000)),
     weights = stu_wgt,
     REML = FALSE)

tab_model(mod1, mod2, show.stat=TRUE, show.aic = TRUE)
```

As seen before, all the predictors remain significant with positive relationship to scores. Access to a computer, internet, more books and high socioeconomic status are positively predictive . Father's education level is also predictive of higher individual scores.

Interestingly, ICC or intra-class correlation coefficient is 0 in both of these models. This implies that the proportion of variance explained by the grouping structure (schools within a country) is 0 suggesting that a mixed effects model in this case may not be necessary.

A comparison of these model deviances shows that the difference is indeed significant: 

```{r}
anova(mod1, mod2, refit = FALSE)
```

Including the additional variables at the school level likely adds value. 

Here are the random effects for the second model with both individual and school level variables: 

```{r model_school_id3}
#| fig-height: 12
p1 <- plot_model(mod2, type  = "re")[[1]]
xlabels <- as.character(p1$data$term)
oldxlabels <- xlabels
first_finland <- grep("Finland", xlabels,value = FALSE)[length(grep("Finland", xlabels,value = FALSE))]
first_SK <- grep("South Korea", xlabels,value = FALSE)[length(grep("South Korea", xlabels,value = FALSE))]
first_Poland <- grep("Poland", xlabels,value = FALSE)[length(grep("Poland", xlabels,value = FALSE))]
first_usa <- grep("United", xlabels,value = FALSE)[length(grep("United", xlabels,value = FALSE))]
xlabels[!seq_along(xlabels) %in% c(first_finland, first_SK, first_Poland, first_usa)] <- ""
names(xlabels) <- oldxlabels

p2 <- plot_model(mod2, type  = "re", 
           width = .5, 
           show.values = T)[[2]]

grid.arrange(p1 + scale_x_discrete(labels = xlabels), p2, ncol=2)
```

Among the random variables, we see that 

- Inter-school variability is pronounced in United States and South Korea. 
- There is a large variability at the country level in Finland unlike USA, South Korea and Poland. Its unclear what accounts for this diversity within the country. However scores across schools are more consistent. 
- Poland performs best in terms of the random effect intercept. This is surprising since South Korea and Finland had higher average math scores than Poland. Poland's lower average scores are likely explained by other predictors such as socioeconomic indicators that are accounted for in the model. 

Going back to the fact that the model ICC = 0, let's consider adding random slopes to see if there may be additional differences we are not seeing. 

```{r model_school_id4}
mod3 <- lmer(math ~ #mother_educ_level + 
               gender + internet + 
               n_books + escs  + 
               stratio + public_private +
               (escs | country_name)+(1 | country_name:school_id) ,
     data=sub_math_df,
     control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000)),
     weights = stu_wgt,
     REML = FALSE)

summary(mod3)

```

In spite of simplifying the model level 1 predictors, we see that there are issues with singularity when we add `escs` to have a random slope likely because we see a correlation of variances close to 1.0. 



### Schools in a Country: 2 Level Model

Now, we look at school performances by averaging the individual students math scores within schools to get a school score.

```{r school_preds}
school_df2 <- math_df %>%
  mutate(
    public_private = ifelse(public_private == "public", 0.0, 1.0)
  ) %>%
  mutate(boy_fraction = enrol_boys/school_size) %>% 
  select(math, country_name, school_id,
         # fund_gov, fund_fees,
         fund_donation, 
         boy_fraction,
         stratio, public_private, staff_shortage, 
         school_size, stu_wgt, sch_wgt) %>%
  na.omit() %>%
  filter((country_name %in% c("United States", "South Korea",
                                              "Poland", "Finland"))) %>%
  mutate_at(c("school_size", "staff_shortage", 
              "fund_donation", "stratio", "staff_shortage", "school_size", "boy_fraction"),
            ~(scale(., scale=FALSE) %>% as.vector)) %>%
  group_by(country_name, school_id, fund_donation, boy_fraction, school_size, stratio, public_private, staff_shortage, sch_wgt) %>%
  dplyr::summarize(math = weighted.mean(math,w=stu_wgt,  na.rm = T)) %>%
  ungroup()
  
sch_mod <- lmer(math ~ fund_donation + boy_fraction + school_size + stratio + public_private + staff_shortage + (1 | country_name),
     data=school_df2,
     weights = sch_wgt,
     REML = FALSE)

tab_model(sch_mod)

plot_model(sch_mod, type  = "re", 
           width = .5, 
           show.values = T)

```

-   The only effect that matters appears to be `fund_donation`, `boy_fraction` and public/private. However, school size and student teacher ratio trend towards significance. 

-   The country random effect was also very important. Again, Finland showed high variability in school performances.

Since ICC = 0 for these models, it is unclear that the random effects are explaining variance in the data. 

### The curious case of Finland

Finland shows uniformity among schools but large variability at the country level. Perhaps we would need to model this with varying slopes for the predictors and how they interact within each school. This unfortunately led to models at/near singularity. Instead I simplified the model by removing the country level and looking at Finland alone grouped by its schools.

```{r finland}
finland_df <- sub_math_df %>% filter(country_name == "Finland")

mod_f <- lmer(math ~ father_educ_level + gender + computer + internet + n_books + escs  + 
                (father_educ_level + gender + computer + internet + n_books + escs  | school_id),
     data=finland_df,
     control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=50000)),
     weights = stu_wgt, REML=FALSE)

tab_model(mod_f)
```

```{r finland2}
#| fig-width: 12
#| fig-height: 14
plot_model(mod_f, type  = "re") + theme(text = element_text(size=8))
```

*This still led to a near singular model because of model complexity*

If the model is to be trusted, we see that individual variability within schools is high for whether or not one has access to internet. Also surprisingly, unlike the nested countries model, internet was not significantly predictive for math scores in Finland. This highlights a limitation of the modeling approach. Different countries and potentially schools have different responses to each of the predictors. A varying slopes model for each predictor with multiple levels may be ideal but such models fail to converge.

## Back to the Book {#sec-book}

Here are some things that stood out to me from the book and may not have been evident from the data models:

1.  Expectations for teacher excellence
    -   Finnish teacher training programs are prestigious and extremely selective (think Georgetown to MIT acceptance rates!) while US teacher programs have a low admission bar.
    -   Korean Hogwans (private after school college prep tutoring) teachers earn very well and their performance is evaluated by student and parent surveys which in turn determines teacher dismissals
    -   In Finland, teachers undergo 1 year of practical training as opposed to 12 - 15 weeks required in USA.
2.  Student's innate drive
    -   In high pressure environments like Korea, students have an innate drive that is reinforced by parents, peers and culture
    -   There is an understanding and expectation of oneself that academics is meaningful and important for future success in life
3.  Curriculum standards
    -   When school demands less of kids they lose interest and don't take it seriously.
    -   Standardized tests with reasonable challenge (think harder than SATs) may be useful as a tool to cultivate drive and create manageable pressure along with providing goals and aspirations.
    -   American schools tend to have lower standards (math is 2 grades below Korean schools!) with a heavy emphasis on sports. This is further emphasized by high standards and the presidential tests. The focus on athletics may drain resources from academics.
    -   Rigor can also be counteracted by trivialized assignments e.g multiple choice questions and poster projects that don't promote as much critical thinking
4.  Cultural mindsets
    -   Korean society supports their students on the national standardized test day by delaying stock markets to minimize traffic and grounding planes to avoid excessive noise.
    -   *Sisu* is a cultural mindset in Finland that encapsulates grit, determination, tenacity and resilience in one word.
5.  Parental involvement
    -   Oddly parent participation in school through volunteer opportunities and PTA roles did not enhance a child's learning outcomes
    -   Instead, activities like daily reading and discussion on a variety of topics to enrich a child's learning more directly were beneficial.
    -   Parents serving as coaches rather cheerleaders are more effective by offering authentic and not excessive praise. An authoritative parenting style should foster independence but also enforce firm boundaries.
6.  Distances in teacher-student relationships to preserve rigor
    -   Teachers in Finland actually aim for minimal empathy and no labeling to preserve rigor and avoid such systemic biases.
    -   In America, teachers strive to build personal relationships with their students. There is also an effort to foster inclusive environments. But does a blinded approach work better?

Interestingly, the above features dominate things like racial disparities and poverty. Oddly, labeling children by race or economic status might have actually impeded an unbiased approach to teaching.

## Summary

It was interesting to dive into the complexities of education systems. I also had an appreciation for the investigative approaches in the book which offered more qualitative findings.

#### Did my models agree with the book???


With the information available, I wasn't able to evaluate an individual student's personal motivation and attitude towards education. This would have been a very interesting factor to study and correlate with the book's findings.

My models certainly leaned in the same direction as the book in certain key findings:

-   They point towards the importance of academic rigor since predictors such as having computers, access to internet and more books were important for higher scores.

-   Perhaps the reason private schools had higher scores may be explained by higher educational standards that foster academic rigor. Although this may also be convoluted by socioeconomic factors!

-   The design based linear models also highlighted the importance of teaching since student-teacher ratio was predictive of a school's overall score. This predictor was not significant in mixed models. However, the mixed models may not be as useful since ICC = 0 suggested that observations within country/school groups are no more similar than observations from different groups.

Overall, building systems that beget academic excellence is very challenging. I definitely recommend this book to educators, parents and policy-makers as we can each play a part in motivating a value system reform that instills academic drive at the individual and societal level.
